# 프로젝트 명 : 방화벽 네트워크 구성을 이용한 웹 취약점 툴 점검/조치 및 로그 분석



## 1.프로젝트 목표
****
 - 스캔후 나온 리스트로 취약점 조치
 - 웹 스캔을 통한 로그 분석





### 2. 프로젝트 요약
****

웹 스캔 및 취약점 조치
AWS CLOUD와 포트포워딩을 통한 방화벽 구성으로 웹 서버에 취약점 스캔을 했다.
스캔 후 방화벽에서는 트래픽이 순식간에 올라가 접속자가 어떤 행위를 시도 했다는것을 짐작할 수 있다는걸 알 수 있다. 그 후 arachni에서는 취약점 리스트가 나와Unencrpyted password form과 Common directory취약점이 발견 되었다. 즉 http 를 사용하고 있어서 중요 텍스트가 평문으로 전송되며 흔한이름의 파일들이 존재하여 웹서버에 중간정도의 위험을 초래할 수 있다는 것 이었다. 먼저 존재하는 취약점인지 검증 후 확인되어 조치 하였음.

**로그 분석**
테스트한 웹서는 kali linux를 사용하였고, 기본으로 /var/log/apache2/access.log에 저장되어 있다. 먼저 공격자 ip만 추출하여 접속자 ip인 13.209.98.12.txt로 따로 저장해 두어 access.log의 포멧을 분석하여 작성했다. 하지만 가독성이 너무 떨어져 Goaccess의 오픈소스를 이용해 접속자가 어떤 사이트를 요청하고 응답 하였는지 시각화 시켰켯으며 접속자가 어떤 도구를 사용하였는지 요청값과, 서버가 제공해준 파일 등을 알 수 있었다.







3.프로젝트 설명
****

부가적인 설명
****
가상 머신의 네트워크에서는 3가지 종류로 구성할 수 있는데 NAT, HOST-ONLY, Bridge 가 존재

NAT(Network Address Translation) :  호스트 PC로부터 IP를 할당받아 가상머신 프로그램이 자동으로 IP를 할당하여 HOST PC와 통신
(ex host:192.168.0.100이면 가상먼신은 10.211.55.5이런식의 IP를 할당받음)

Host-Only : 외부와 단절된 내부 네트워크로 가상머신들끼리만 통신이 가능함

Bridge : 공유기로 부터 IP를 할당받아, HOST PC와 같은 네트워크 대역의 IP를 가짐
(ex host : 192.168.0.100면 Bridge네트워크의 가상머신은 같은 대역인 192.168.0.200의 대역을 가지게 됨)

보시는 것처럼 가상머신의 네트워크 설정을 Bridge 연결하여 라우터의 모든 트래픽이 방화벽을 거치게 만들었고, 방화벽을 거친 후 host only 네트워크인 웹 서버로 갈 수 있게 하였다.

<Black list 와 With list>

Black list 모든 포트가 허용된상태 
Ex)게임 채팅시 모든 사람이 나에게 메시지를 줄 수 있다. 필요 시 차단가능

Wite list 모든포트가 닫혀있는 상태
Ex)게임 채팅시 내가 허용한 사람만 나에게 대화를 걸 수 있고 필요 시, 허용가능


그 후 AWS CLOUD에 Arachni설치하여 웹 취약점 스캔

방화벽은 기본적으로 Wite List 정책으로 따로 포트를 열어줘서 수행했다.


<웹 스캔할 로그인 페이지>























### <스캔 후 방화벽의 트래픽>
모든 포트 OPEN


순식간에 트래픽이 올라가는걸 확인할 수 있다.
Ex ) 트래픽 : 데이터 접속량
모든 포트를 열어 두었기 때문에 제한된 포트 정보는 존재하지 않는다.

방화벽의 모든 포트를 닫아 두었을 때

모든 포트가 닫혀있을 때는 트래픽이 올라가지 않고 제한 되었다는 정보만 생기는 것을 볼 수 있다.

Arachni에서도 시도 했지만 모든 포트가 닫혀 있기 때문에 응답 받을 수 없어 실패했다.


스캔후 발견된 medium  취약점 분석
****
 
Medium은 총 3 개 발견
- Unencrpyted password form


좀 더 자세한 설명을 보면 
HTTP를 사용하기 때문에 데이터가 암호화 되지 않고 평문(암호화 되지 않은 데이터)으로 전송된다. 내용을 보면 모든 데이터(id,password와 같은 중요한정보)를 볼 수 있고 패킷 캡쳐 또한 가능하다는 것을 의미한다고 나와있다.

즉, HTTP는 데이터를 전송 할때 암호화 하지 않으므로 HTTP + SSL인 HTTPS를 사용하는 것을 권고하는 것이다.

- Common directory

이 취약점은 알려진 이름 (/admin, /master, /bbs, /etc, /config 등)을 요청하여 노출 되거나 접속가능하면 나오는 취약점

검증

- 확인해보니 config/와 docs가 노출이 되어있고 접근가능 가능한 것을 볼 수 있다.

여기서 확인할 것은
common directory
directory listing
두가지 취약점이 존재


즉, 취약점을 보안하는 방법은 흔히쓰는 이름(/admin, /master, /bbs, /etc, /config 등)을 변경하고, 인증(id, password..같은)을 통한 접근제어를 하는 것으로 취약점을 해결할 수 있다.

웹 스캔을 통한 로그 분석
****
스캔후 /var/log/apache2/access.log 파일의 내용
이런 형식으로 저장이 되어있는데

접속자 ip : 13.209.98.12
접속시간 : [20/Feb/2020/09:14:04 - 0500]
요청값 : GET /config/?c=-1839
프로토콜 : HTTP
응답값 : 200
요청한 파일 크기 : 668

이렇게 나누어져 있음을 알 수 있다.

가독성을 높이기 위해 GoAccess라는 오픈소스를 가져다 확인했다.
**오픈소스**: 누구나 특별한 제한 없이 자유롭게 사용, 복제, 배포, 수정할 수 있는 소프트웨어
여기서 보면 총 요청값, 요청받은 파일. Not found 전송횟수등이 통계로 나와있는것을 확인할 수 있다.

좀 더 자세한 내용을 확인해 보면
접속자(13.209.98.12)가 **Arachni scan**을 시도 했다는 것을 확인할 수 있고, 흔하게 존재할 수 있는 admin, setup ,php ,config ,docs등을 무작위로 페이지 요청을 한 후 존재하면 취약점 리스트에 올려주는것을 확인 할 수 있었다.
